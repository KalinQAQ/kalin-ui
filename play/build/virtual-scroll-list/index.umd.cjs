(function(f,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(f=typeof globalThis<"u"?globalThis:f||self,i(f.index={},f.vue))})(this,function(f,i){"use strict";function b(t){return t.install=function(a){const{name:r}=t;a.component(r,t)},t}const M={dataSources:{type:Array,required:!0,default:()=>[]},dataKey:{type:String,required:!0},keeps:{type:Number,default:30},estimateSize:{type:Number,default:80},dataComponent:{type:[Object,Function],required:!0}},V={uniqueKey:{type:[String,Number]},source:{type:Object,required:!0},component:{type:[Object,Function]}};function k(t,a){let r=0,c="INIT",l=0,p=0;const h=new Map,d={start:0,end:0,padFront:0,padBehind:0};function g(){return c==="FIXED"}function S(){return g()?p:l||t.estimateSize}function o(e){if(!e)return 0;let n=0;for(let u=0;u<e;u++){const s=h.get(t.uniqueIds[u]);n+=typeof s=="number"?s:S()}return n}function I(){return g()?p*d.start:o(d.start)}function m(){return(t.uniqueIds.length-1-d.end)*S()}function z(e,n){d.start=e,d.end=n,d.padFront=I(),d.padBehind=m(),a({...d})}function q(e,n){const u=t.uniqueIds.length,s=t.keeps;u<s?(e=0,n=u-1):n-e<s-1&&(e=n-s+1),z(e,n)}function N(){if(g())return Math.floor(r/S());{let e=0,n=t.uniqueIds.length,u=0,s=0;for(;e<=n;){if(u=e+Math.floor((n-e)/2),s=o(u),s==r)return u;s<r?e=u+1:s>r&&(n=u-1)}return e>0?--e:0}}function y(e){const n=e+t.keeps-1;return Math.min(n,t.uniqueIds.length-1)}function v(){const e=N();if(e>d.start)return;const n=Math.max(e-t.buffer,0);q(n,y(n))}function F(){const e=N();e<d.start+t.buffer||q(e,y(e))}function B(e){const n=e<r?"FRONT":"BEHIND";r=e,n==="FRONT"?v():n==="BEHIND"&&F()}function E(e,n){h.set(e,n),c==="INIT"?(p=n,c="FIXED"):c==="FIXED"&&p!==n&&(c="DYNAMIC",p=0),c==="DYNAMIC"&&h.size<Math.min(t.keeps,t.uniqueIds.length)&&(l=[...h.values()].reduce((u,s)=>u+s,0)/h.size)}return q(0,t.keeps-1),{handleScroll:B,saveSize:E}}const x=i.defineComponent({name:"virtual-item",props:V,emits:["itemResize"],setup(t,{emit:a}){const r=i.ref(null);function c(){var l;a("itemResize",t.uniqueKey,(l=r.value)==null?void 0:l.offsetHeight)}return i.onMounted(c),i.onUpdated(c),()=>{const{component:l,source:p,uniqueKey:h}=t;return l&&i.createVNode("div",{key:h,ref:r},[i.createVNode(l,{source:p},null)])}}}),R=b(i.defineComponent({name:"k-virtual-scroll-list",props:M,setup(t,{}){const a=i.ref(null),r=o=>{a.value=o},c=()=>{const{dataSources:o,dataKey:I}=t;return o.map(m=>m[I])};let l;const p=()=>{l=k({keeps:t.keeps,buffer:Math.round(t.keeps/3),uniqueIds:c(),estimateSize:t.estimateSize},r)};i.onBeforeMount(()=>{p()});function h(){const o=[],{start:I,end:m}=a.value,{dataSources:z,dataComponent:q,dataKey:N}=t;for(let y=I;y<=m;y++){const v=z[y];if(v){const F=v[N];o.push(i.createVNode(x,{uniqueKey:F,source:v,component:q,onItemResize:d},null))}}return o}function d(o,I){l.saveSize(o,I)}const g=i.ref();function S(){if(g.value){const o=g.value.scrollTop;l.handleScroll(o)}}return()=>{const{padBehind:o,padFront:I}=a.value,m={padding:`${I}px 0 ${o}px`};return i.createVNode("div",{onScroll:S,ref:g},[i.createVNode("div",{style:m},[h()])])}}}));f.default=R,f.virtualItemProps=V,f.virtualProps=M,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
