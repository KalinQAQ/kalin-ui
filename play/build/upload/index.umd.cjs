(function(p,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(p=typeof globalThis<"u"?globalThis:p||self,e(p.index={},p.vue))})(this,function(p,e){"use strict";function F(n){return n.install=function(a){const{name:r}=n;a.component(r,n)},n}const S=["onDragover","onDrop"],C=e.defineComponent({__name:"upload-dragger",emits:["file"],setup(n,{emit:a}){const r=e.ref(!1),c=l=>{l.stopPropagation(),a("file",Array.from(l.dataTransfer.files))},i=function(){r.value=!0};return(l,s)=>(e.openBlock(),e.createElementBlock("div",{onDragover:e.withModifiers(i,["prevent"]),onDragleave:s[0]||(s[0]=e.withModifiers(d=>r.value=!1,["prevent"])),onDrop:e.withModifiers(c,["prevent"])},[e.renderSlot(l.$slots,"default")],40,S))}}),_={FileList:{type:Array,default:()=>[]},action:{type:String,default:""},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},accept:{type:String,default:""},method:{type:String,default:"post"},headers:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})},drag:{type:Boolean,default:!1}},f=()=>{},b={..._,onPreview:{type:Function,default:f},beforeUpload:{type:Function,default:f},onChange:{type:Function,default:f},beforeRemove:{type:Function,default:f},onRemove:{type:Function,default:f},onProgress:{type:Function,default:f},onSuccess:{type:Function,default:f},onError:{type:Function,default:f}};let E=0;const P=()=>E++;function m(n,a,r,c){return a&&(n+=`-${a}`),r&&(n+=`__${r}`),c&&(n+=`--${c}`),n}function k(n){return{b:(t="")=>m(n,t,"",""),e:(t="")=>t?m(n,"",t,""):"",m:(t="")=>t?m(n,"","",t):"",be:(t="",u="")=>t&&u?m(n,t,u,""):"",bm:(t="",u="")=>t&&u?m(n,t,"",u):"",em:(t="",u="")=>t&&u?m(n,"",t,u):"",bem:(t="",u="",h="")=>t&&u&&h?m(n,t,u,h):"",is:(t,u)=>u?`is-${t}`:""}}function R(n){const a=`k-${n}`;return k(a)}const g=()=>{},$={..._,beforeUpload:b.beforeUpload,onStart:{type:Function,default:g},onProgress:{type:Function,default:g},onRemove:{type:Function,default:g},onError:{type:Function,default:g},onSuccess:{type:Function,default:g}};function v(n){const a=new XMLHttpRequest,r=n.action;if(a.open(n.method,r,!0),a.upload.addEventListener("progress",l=>{const s=l;s.pecetange=l.total>0?l.loaded/l.total*100:0,n.onProgress(s)}),n.headers)for(const[l,s]of Object.entries(n.headers))a.setRequestHeader(l,s);const i=new FormData;if(n.data)for(const[l,s]of Object.entries(n.data))i.append(l,s);return i.append(n.name,n.file),a.onload=function(){a.status<300&&a.status>=200?n.onSuccess(a.response):n.onError({status:a.status})},a.addEventListener("error",function(l){n.onError(l)}),a.send(i),a}const O=["name","accept","multiple"],B=e.defineComponent({name:"k-upload",inheritAttrs:!1}),D=e.defineComponent({...B,props:$,setup(n){const a=n,r=R("upload");async function c(o){if(i.value.value="",await a.beforeUpload(o)===!1)return a.onRemove(o);const{method:u,name:h,action:M,headers:w,data:T}=a;v({method:u,name:h,file:o,action:M,headers:w,data:T,onError:y=>{a.onError(y,o)},onSuccess:y=>{a.onSuccess(y,o)},onProgress:y=>{a.onProgress(y,o)}})}const i=e.ref();function l(o){for(let t=0;t<o.length;t++){const u=o[t];u.uid=P(),a.onStart(u),c(u)}}const s=o=>{const t=o.target.files;l(t)},d=()=>{var o;i.value.value="",(o=i.value)==null||o.click()};return(o,t)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([e.unref(r).b()]),onClick:d},[o.drag?(e.openBlock(),e.createBlock(C,{key:0,onFile:l},{default:e.withCtx(()=>[e.renderSlot(o.$slots,"default")]),_:3})):e.renderSlot(o.$slots,"default",{key:1}),e.createElementVNode("input",{ref_key:"inputRef",ref:i,type:"file",name:o.name,accept:o.accept,multiple:o.multiple,onChange:s},null,40,O)],2))}}),L=e.defineComponent({name:"k-upload"}),U=e.defineComponent({...L,props:b,emits:["onUpdate:file-list"],setup(n,{emit:a}){const r=n,c=e.ref(r.FileList);e.watch(c,s=>{a("onUpdate:file-list",s)});const i=s=>c.value.find(d=>d.uid===s.uid),l=e.computed(()=>({...r,onStart:s=>{const d={uid:s.uid,name:s.name,percentage:0,raw:s,size:s.size,status:"start"};d.url=URL.createObjectURL(s),c.value=[...c.value,d],r.onChange(d)},onProgress:(s,d)=>{const o=i(d);o.status="uploading",o.percentage=s.pecetange,r.onProgress(s,o,c.value)},onRemove:async s=>{const d=i(s);if(await r.beforeRemove(d,c.value)!==!1){const t=c.value;t.splice(t.indexOf(d),1),r.onRemove(d,c.value)}},onError:(s,d)=>{const o=i(d);o.status="error";const t=c.value;t.splice(t.indexOf(o),1),r.onError(s,o,t)},onSuccess:(s,d)=>{const o=i(d);o.status="success";const t=c.value;r.onSuccess(s,o,t)}}));return(s,d)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(D,e.normalizeProps(e.guardReactiveProps(l.value)),{default:e.withCtx(()=>[e.renderSlot(s.$slots,"default")]),_:3},16),e.createTextVNode(" "+e.toDisplayString(c.value)+" ",1)],64))}}),j=F(U);p.baseProps=_,p.default=j,p.genId=P,p.uploadProps=b,Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
